@using UIComponents.Abstractions;
@using UIComponents.Abstractions.DataTypes.RecurringDates.Selectors
@using UIComponents.Abstractions.Extensions;
@using UIComponents.Abstractions.Models
@using UIComponents.Generators.Interfaces;
@using UIComponents.Models.Models.Buttons
@using UIComponents.Models.Models.Card;
@using UIComponents.Models.Models;
@using UIComponents.Models.Extensions;
@using UIComponents.Models.Models.Dropdown
@using UIComponents.Models.Models.Graphs.TimeLineGraph
@using UIComponents.Models.Models.Icons
@using UIComponents.Models.Models.Inputs
@using UIComponents.Models.Models.Texts
@using UIComponents.Web.Extensions;
@using UIComponents.Web.Tests.Factory

@{
    ViewData["Title"] = "Home Page";
}

@inject IUIComponentGenerator UIC
@{
    var testModel = new TestModel();
    testModel.RecurringDate = new();
    testModel.RecurringDate.Included.Add(new()
    {
        EndDate = DateOnly.FromDateTime(DateTime.Today.AddDays(5)),
    Pattern = new RecurringWeekly()
        {
            Monday = true,
            Tuesday = true,
            Wednesday = true,
        }

    });
    testModel.RecurringDate.Excluded.Add(new()
    {
        Pattern = new RecurringMonthly()
        {
            Instance = RecurringMonthly.MonthlyInstance.First,
            RecurringStyle = 1,
        }
    });
    var tabs = new UICTabs("TestTabs")
            {
                OnlyRenderSingleContent = true
            }
        .Add(out var formTabs, new UICTabs("FormTabs")
                {
                    Header = new UICCardHeader("Forms"),
                    Renderer = UICCardWithTabsRenderer.Vertical
                }
        .Add(new UICCard(new Translatable("Card.Create"))
            .Add(await UIC.CreateComponentAsync(testModel, new()
                    {
                        ReplaceSaveButtonWithCreateButton = true,
                        ShowEditButton = false,
                        //IncludedProperties = "teststring, number, decimal, checkbox, enum, recurringDate,SubClass",
                        PostForm = new UICActionPost("home", "post")
                    })).Add(await UIC.CreateComponentAsync(testModel, x => x.TestString)))
        .Add(new UICCard(new Translatable("Card.Edit"))
            .Add(new UICSidePanel(await UIC.CreateComponentAsync(new TestModel()), new UICGroup()
                    .AddAttribute("width", "300px")
                    .AddAttribute("height", "100%"))), sidePanel =>
                    {
                        var color = sidePanel.FindInputGroupByPropertyName(nameof(TestModel.Color));
                        color.PrependInput.Add(new UICIcon("fas fa-square"));
                        color.AppendInput.Add(new UICSpan("blub"));

                        sidePanel.FindInputGroupByPropertyName(nameof(TestModel.TestString)).PrependInput.Add(new UICIcon("fas fa-user"));
                        sidePanel.FindInputGroupByPropertyName(nameof(TestModel.Enum)).PrependInput.Add(new UICIcon("fas fa-user"));
                    })

        .Add(new UICCard(new Translatable("Card.Partial"))
            .AddPartial("Home", "test")
            ))
    .Add(new UICCard(new Translatable("Card.Partial"))
            .AddPartial("Home", "test"));

    formTabs.Add(new UICCard("Card.SelectList").AddPartial("home", "selectlist"));
    tabs.FindInputGroupByPropertyName(nameof(TestModel.Enum), (input)=>{
        input.AppendInput.Add(new UICButton() { PrependButtonIcon = UICIcon.Add() });
    });
    formTabs.Add(new UICCard("Subclass").AddPartial("Home", "TestSubClass"));


    tabs.Add(new UICCard(new UICCardHeader("Chart")).Add(new UICTimeLineGraph(), graph =>
    {
        graph.Start = DateTime.Now.AddMinutes(-1);
        graph.Add(new("Graph1", "blub", "/home/GetTimelineChartData") { CacheData = true, RemoveCacheOnZoom = true, AdditionalPostData = new { UserId = 1 }, Fill = true });
        graph.Add(new("Graph2", "foo", "/home/GetTimelineChartData"){CacheData = true, RemoveCacheOnZoom = true, Tension=0.5});
    }));

    tabs.Add(new UICCard("FileExplorer").AddPartial("home", "files"));

    var factoryComponent = new UICFactory<TestComponentFactory>(f => f.CreateComponentAsync(2));
    factoryComponent = new UICFactory<TestComponentFactory>("/Views/Home/TestViewModelFromFactory", async f => await f.CreateViewModelAsync(2));
    tabs.Add(new UICCard("factoryComponent").Add(factoryComponent));


}

@await tabs.InvokeAsync(Component)
