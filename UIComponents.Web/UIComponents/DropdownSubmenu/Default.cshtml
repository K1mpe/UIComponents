@using UIComponents.Abstractions.Attributes;
@using UIComponents.Abstractions.Interfaces;
@using UIComponents.Abstractions.Interfaces.ExternalServices;
@using UIComponents.Abstractions.Models;
@using UIComponents.Abstractions.Extensions;
@using UIComponents.Defaults;
@using UIComponents.Models;
@using UIComponents.Models.Models;
@using UIComponents.Models.Models.Actions;
@using UIComponents.Models.Models.Buttons;
@using UIComponents.Models.Models.Card;
@using UIComponents.Models.Models.Dropdown;
@using UIComponents.Models.Models.Icons;
@using UIComponents.Models.Models.Inputs;
@using UIComponents.Models.Models.Texts;
@using UIComponents.Web.Extensions;

@inject IUicLanguageService L

@model UICDropdownSubMenu


@{
    string id = Model.GetOrGenerateId();

    Model.AssignCollectionForChildren();

    Model.AddAttribute("class", "dropdown-toggle dropdown-item")
    .AddAttribute("role", "button")
    .AddAttribute("href", "#")
    .AddAttribute("aria-haspopup", "true");


    var subItems = Model.Items.Where(x => x.HasValue()).ToList();
}

@if(subItems.Where(x=>x.HasValue() && x is not UICDropdownDivider).Count() == 1 && Model.ReplaceBySingleItem)
{
    @await subItems.Where(x=>x.HasValue() && x is not UICDropdownDivider).First().InvokeAsync(Component)
}
else
{
    Model.AddScript(
            @<text>
            $('#@id').click(function(e){
                e.stopPropagation();
                e.preventDefault();
            });
            </text>);

    <li class="dropdown-submenu dropdown-hover">
        <a @Html.Raw(Model.GetHtmlAttributes())>
            @if (Model.Icon.HasValue())
            {
                @await Model.Icon.InvokeAsync(Component)
            }
            else
            {
                <span class="icon"></span>
            }
        @await Html.Translate(L,Model.Content, null)
        </a>
        <ul class="dropdown-menu">
            @foreach (var item in subItems)
            {
                @await item.InvokeAsync(Component)
            }
        </ul>

    </li>
}


@await Model.RenderStylesAndScripts(Component)